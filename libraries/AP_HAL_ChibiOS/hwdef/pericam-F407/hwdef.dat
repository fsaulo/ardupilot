# hw definition file for processing by chibios_hwdef.py
# for pericam-F407 board

# MCU class and specific type
MCU STM32F4xx STM32F407xx

# board ID for firmware load
APJ_BOARD_ID 1200

# crystal frequency
OSCILLATOR_HZ 8000000

# ChibiOS system timer
STM32_ST_USE_TIMER 5

STORAGE_FLASH_PAGE 1
FLASH_RESERVE_START_KB 64
FLASH_SIZE_KB 1024

USB_PRODUCT 0x0201 # fmu usb driver
USB_STRING_MANUFACTURER "UFS/DEL"

# The normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, USB)
# 2) SERIAL1: telem1
# 3) SERIAL2: telem2
# 3) SERIAL3: GPS1
# 4) SERIAL4: GPS2

SERIAL_ORDER OTG1 EMPTY USART1 USART3

# USART1 serial1 output
PA9  USART1_TX USART1 NODMA
PA10 USART1_RX USART1 NODMA

# USART3 serial3 telem1
PD8 USART3_TX USART3 NODMA
PD9 USART3_RX USART3

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

STDOUT_SERIAL SD1
STDOUT_BAUDRATE 57600

# USB detection
PA8 VBUS INPUT OPENDRAIN

# SPI1 for dataflash
PB3  SPI1_SCK  SPI1
PB4  SPI1_MISO SPI1
PB5  SPI1_MOSI SPI1
PA15 W25Q16_CS CS

SPIDEV mpu6000   SPI1 DEVID1 ICM20689_CS MODE3 1*MHZ  8*MHZ 
SPIDEV dataflash SPI1 DEVID1 W25Q16_CS   MODE3 32*MHZ 32*MHZ

I2C_ORDER I2C1

PB8 I2C1_SCL I2C1
PB9 I2C1_SDA I2C1
PB10 I2C2_SCL I2C2
PB11 I2C2_SDA I2C2

PC4 ICM20689_CS CS
PC5 ICM20689_DRDY INPUT

# analog pins
PC3 BATT_VOLTAGE_SENS ADC1 SCALE(1)
PC2 BATT_CURRENT_SENS ADC1 SCALE(1)

# Setup the pins for the microSD card
PC10 SDIO_D2  SDIO
PC11 SDIO_D3  SDIO
PD2  SDIO_CMD SDIO
PC12 SDIO_CK  SDIO
PC8  SDIO_D0  SDIO
PC9  SDIO_D1  SDIO

# one baro
BARO BMP280 I2C:0:0x76
define AP_BARO_BACKEND_DEFAULT_ENABLED 0
define AP_BARO_BMP280_ENABLED 1

define HAL_GENERATOR_ENABLED 0
define HAL_WITH_DSP FALSE
define HAL_GYROFFT_ENABLED 0
define HAL_WITH_RAMTRON 0
define HAL_OS_FATFS_IO 0
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"
define HAL_STORAGE_SIZE 15360
define HAL_LOGGING_DATAFLASH_ENABLED 1
define HAL_BARO_ALLOW_INIT_NO_BARO

# PWM out pins
PA0  TIM2_CH1 TIM2 PWM(1) GPIO(50)
PA1  TIM2_CH2 TIM2 PWM(2) GPIO(51)
PA2  TIM2_CH3 TIM2 PWM(3) GPIO(52)
PA3  TIM2_CH4 TIM2 PWM(4) GPIO(53)
PE9  TIM1_CH1 TIM1 PWM(5) GPIO(54)
PE11 TIM1_CH2 TIM1 PWM(6) GPIO(55)


# LED setup is similar to PixRacer
PE2 LED_GREEN OUTPUT GPIO(11)
PE3 LED_BLUE  OUTPUT GPIO(12)

# for debug only
# define BRD_OPTIONS 9

# disable unused features
define AP_BATTMON_SMBUS_ENABLE 0
define AC_OAPATHPLANNER_ENABLED 0
define AC_PRECLAND_ENABLED 0
define AP_ICENGINE_ENABLED 0
define AP_OPTICALFLOW_ENABLED 0
define AP_PARAM_MAX_EMBEDDED_PARAM 1024
define PRECISION_LANDING 0
define GRIPPER_ENABLED 0
define AP_OPTICALFLOW_ENABLED 0
define AP_ICENGINE_ENABLED 0
define AP_RANGEFINDER_ENABLED 0
define AP_RPM_EFI_ENABLED 0
define AP_RPM_PIN_ENABLED 0
define AP_RPM_GENERATOR_ENABLED 0
define HAL_PARACHUTE_ENABLED 0
define HAL_HOTT_TELEM_ENABLED 0
define HAL_NMEA_OUTPUT_ENABLED 0
define HAL_BUTTON_ENABLED 0
define HAL_OREO_LED_ENABLED 0
define HAL_SPRAYER_ENABLED 0

# eco flash usage
include ../include/minimal.inc
