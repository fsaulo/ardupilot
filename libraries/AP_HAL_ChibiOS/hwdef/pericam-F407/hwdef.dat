# hw definition file for processing by chibios_hwdef.py
# for pericam-F407 board

# MCU class and specific type
MCU STM32F4xx STM32F407xx

# board ID for firmware load
APJ_BOARD_ID 1200

# crystal frequency
OSCILLATOR_HZ 8000000

# ChibiOS system timer
STM32_ST_USE_TIMER 5

STORAGE_FLASH_PAGE 1
FLASH_RESERVE_START_KB 64
FLASH_SIZE_KB 1024

USB_PRODUCT 0x0201 # fmu usb driver
USB_STRING_MANUFACTURER "UFS/DEL"

# The normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, USB)
# 2) SERIAL1: telem1
# 3) SERIAL2: telem2
# 4) SERIAL3: GPS1
# 5) SERIAL4: GPS2
# 6) SERIAL5: extra UART (usually RTOS debug console)

SERIAL_ORDER OTG1 USART1 EMPTY USART2 EMPTY USART3

# USART1 serial1 output
PA9  USART1_TX USART1 NODMA
PA10 USART1_RX USART1

# USART2 serial2 gps
PD5 USART2_TX USART2
PD6 USART2_RX USART2

# USART3 serial3 telem1
PD8 USART3_TX USART3 NODMA
PD9 USART3_RX USART3

# USART6 for serial RC
PC7 TIM8_CH2 TIM8 RCIN PULLDOWN LOW DMA_CH0

# USB port
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

# Debug port
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# Enable one more serial output
STDOUT_SERIAL SD1
STDOUT_BAUDRATE 57600

# SPI2 for MPU
PB10 SPI2_SCK  SPI2
PC2  SPI2_MISO SPI2
PC3  SPI2_MOSI SPI2

PA5 BMP280_CS  CS
PA4 MPU9250_CS CS

# SPI1 for dataflash
PB3  SPI1_SCK  SPI1
PB4  SPI1_MISO SPI1
PB5  SPI1_MOSI SPI1
PA15 W25Q16_CS CS

SPIDEV dataflash SPI1 DEVID1 W25Q16_CS  MODE3 32*MHZ 32*MHZ
SPIDEV bmp280    SPI2 DEVID2 BMP280_CS  MODE3  5*MHZ  5*MHZ
SPIDEV mpu9250   SPI2 DEVID3 MPU9250_CS MODE3  2*MHZ  4*MHZ

IMU  Invensense SPI:mpu9250 ROTATION_ROLL_180
BARO BMP280     SPI:bmp280

# analog pins
PC5 BATT_VOLTAGE_SENS ADC1 SCALE(1)
PC4 BATT_CURRENT_SENS ADC1 SCALE(1)

# Setup the pins for the microSD card
PC10 SDIO_D2  SDIO
PC11 SDIO_D3  SDIO
PD2  SDIO_CMD SDIO
PC12 SDIO_CK  SDIO
PC8  SDIO_D0  SDIO
PC9  SDIO_D1  SDIO

define AP_BARO_BACKEND_DEFAULT_ENABLED 0
define AP_BARO_BMP280_ENABLED 1

define HAL_GENERATOR_ENABLED 0
define HAL_WITH_DSP FALSE
define HAL_GYROFFT_ENABLED 0
define HAL_WITH_RAMTRON 0
define HAL_OS_FATFS_IO 0
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"
define HAL_STORAGE_SIZE 15360
define HAL_LOGGING_DATAFLASH_ENABLED 1
# define HAL_BARO_ALLOW_INIT_NO_BARO

# PWM out pins
PA0  TIM2_CH1 TIM2 PWM(1) GPIO(50)
PA1  TIM2_CH2 TIM2 PWM(2) GPIO(51)
PA2  TIM2_CH3 TIM2 PWM(3) GPIO(52)
PA3  TIM2_CH4 TIM2 PWM(4) GPIO(53)
PE9  TIM1_CH1 TIM1 PWM(5) GPIO(54)
PE11 TIM1_CH2 TIM1 PWM(6) GPIO(55)

# PWM pins for RC input
PD13 TIM4_CH2 TIM4 PWM(9) GPIO(58)
PD12 TIM4_CH1 TIM4 PWM(10) GPIO(59)
PD15 TIM4_CH4 TIM4 PWM(11) GPIO(60)
PD14 TIM4_CH3 TIM4 PWM(12) GPIO(61)

# LED setup is similar to PixRacer
PE2 LED_GREEN OUTPUT GPIO(11)
PE3 LED_BLUE  OUTPUT GPIO(12)

# for debug only
# define BRD_OPTIONS 9

# disable unused features
define AP_BATTMON_SMBUS_ENABLE 0
define AC_OAPATHPLANNER_ENABLED 0
define AC_PRECLAND_ENABLED 0
define AP_ICENGINE_ENABLED 0
define AP_OPTICALFLOW_ENABLED 0
define AP_PARAM_MAX_EMBEDDED_PARAM 1024
define PRECISION_LANDING 0
define GRIPPER_ENABLED 0
define AP_OPTICALFLOW_ENABLED 0
define AP_ICENGINE_ENABLED 0
define AP_RANGEFINDER_ENABLED 0
define AP_RPM_EFI_ENABLED 0
define AP_RPM_PIN_ENABLED 0
define AP_RPM_GENERATOR_ENABLED 0
define HAL_PARACHUTE_ENABLED 0
define HAL_HOTT_TELEM_ENABLED 0
define HAL_NMEA_OUTPUT_ENABLED 0
define HAL_BUTTON_ENABLED 0
define HAL_OREO_LED_ENABLED 0
define HAL_SPRAYER_ENABLED 0

# eco flash usage
# include ../include/minimal.inc
